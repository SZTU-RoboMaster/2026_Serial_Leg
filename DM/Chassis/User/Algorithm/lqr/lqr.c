#include "lqr.h"
#include "math.h"

/** LQR **/
// 初始化K矩阵
float wheel_K_L[6] = {0, 0, 0, 0, 0, 0};
float joint_K_L[6] = {0, 0, 0, 0, 0, 0};

float wheel_K_R[6] = {0, 0, 0, 0, 0, 0};
float joint_K_R[6] = {0, 0, 0, 0, 0, 0};

/*********************/

// K拟合系数矩阵
float wheel_fitting_factor[6][4] = {
        {-201.300093f,220.537784f,-95.666369f,-1.293148f},
        {-12.622715f,12.777075f,-8.047095f,-0.126453f},

        {-16.190605f,16.426514f,-5.889846f,-0.168563f},
        {-27.981469f,28.305499f,-10.318768f,-0.399241f},

        {-99.011790f,148.516261f,-87.097762f,23.351855f},
        {-15.755751f,23.005475f,-13.402552f,3.816763f}
};float joint_fitting_factor[6][4] = {
        {244.822261f,-208.751745f,47.357919f,5.358206f},
        {16.103965f,-12.291533f,1.508918f,1.108883f},

        {11.584402f,-6.140405f,-1.372256f,1.224489f},
        {17.013373f,-7.375766f,-3.673187f,2.365184f},

        {404.626377f,-434.705323f,167.069003f,22.126973f},
        {47.427862f,-53.800593f,22.231388f,2.804318f}
};

/** 拟合K **/
void chassis_K_matrix_fitting(float L0, float K[6], const float KL[6][4]) {
    for (int i = 0; i < 6; i++) {
        K[i] = KL[i][0] * powf(L0, 3) + KL[i][1] * powf(L0, 2) + KL[i][2] * powf(L0, 1) + KL[i][3] * powf(L0, 0);
    }
}