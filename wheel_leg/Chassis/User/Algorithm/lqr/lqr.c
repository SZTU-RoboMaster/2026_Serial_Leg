#include "lqr.h"
#include "math.h"

/** LQR **/
// 初始化K矩阵
//float wheel_K_L[6] = {0, 0, 0, 0, 0, 0};
//float joint_K_L[6] = {0, 0, 0, 0, 0, 0};
//
//float wheel_K_R[6] = {0, 0, 0, 0, 0, 0};
//float joint_K_R[6] = {0, 0, 0, 0, 0, 0};

float wheel_K[6] = {
        -19.704005f,-2.460158f,-6.482999f,-5.189525f,14.358010f,2.389130f
};float joint_K[6] = {
        12.097046f,1.725750f,5.646495f,4.183662f,59.626285f,6.378566f
};
// K拟合系数矩阵
float wheel_fitting_factor[6][4] = {
        {-201.181041f,223.993539f,-99.046331f,-0.227442f},
        {-1.306709f,3.033227f,-5.843632f,0.161849f},

        {-20.666548f,20.736473f,-7.256635f,-0.060295f},
        {-35.305015f,35.587443f,-12.793874f,-0.132631f},

        {-75.699565f,106.153233f,-57.915971f,14.648797f},
        {-12.477354f,19.359111f,-11.574204f,3.282919f}
};float joint_fitting_factor[6][4] = {
        {189.306242f,-152.598427f,27.152865f,8.790633f},
        {17.128303f,-16.939366f,5.281565f,0.218383f},

        {-14.835944f,19.992984f,-10.457557f,2.476293f},
        {-25.510225f,34.294516f,-17.953628f,4.299793f},

        {491.816118f,-495.838291f,175.125893f,-0.385412f},
        {109.088659f,-110.986817f,39.842205f,-0.724028f}
};

/** 拟合K **/
void chassis_K_matrix_fitting(float L0, float K[6], const float KL[6][4]) {
    for (int i = 0; i < 6; i++) {
        K[i] = KL[i][0] * powf(L0, 3) + KL[i][1] * powf(L0, 2) + KL[i][2] * powf(L0, 1) + KL[i][3] * powf(L0, 0);
    }
}