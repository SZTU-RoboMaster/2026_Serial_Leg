#include "lqr.h"
#include "math.h"

/** LQR **/
// 初始化K矩阵
float wheel_K_L[6] = {0, 0, 0, 0, 0, 0};
float joint_K_L[6] = {0, 0, 0, 0, 0, 0};

float wheel_K_R[6] = {0, 0, 0, 0, 0, 0};
float joint_K_R[6] = {0, 0, 0, 0, 0, 0};

/** 腿长0.24m时的参数 **/
//float wheel_K[6] = {
//        -19.704005f,-2.460158f,-6.482999f,-5.189525f,14.358010f,2.389130f
//};float joint_K[6] = {
//        12.097046f,1.725750f,5.646495f,4.183662f,59.626285f,6.378566f
//};
/*********************/

// K拟合系数矩阵
float wheel_fitting_factor[6][4] = {
        {-146.640983f,171.183159f,-81.483174f,-2.772656f},
        {-2.309729f,2.946303f,-4.960791f,-0.491484f},

        {-9.339630f,10.538552f,-4.319620f,-0.310155f},
        {-12.689778f,14.786656f,-6.468446f,-0.802392f},

        {-26.889463f,33.362127f,-17.013419f,4.619302f},
        {-10.016478f,13.276957f,-7.259380f,2.108268f}
};float joint_fitting_factor[6][4] = {
        {201.110479f,-170.679549f,34.569302f,9.204603f},
        {-3.048448f,4.360565f,-3.050024f,1.812965f},

        {-2.314146f,7.112939f,-6.055244f,2.069289f},
        {-10.471629f,18.659787f,-12.677471f,3.846943f},

        {108.929584f,-115.636889f,44.435495f,-0.873806f},
        {48.754672f,-52.165439f,20.244949f,-0.166990f}
};
/** 拟合K **/
void chassis_K_matrix_fitting(float L0, float K[6], const float KL[6][4]) {
    for (int i = 0; i < 6; i++) {
        K[i] = KL[i][0] * powf(L0, 3) + KL[i][1] * powf(L0, 2) + KL[i][2] * powf(L0, 1) + KL[i][3] * powf(L0, 0);
    }
}