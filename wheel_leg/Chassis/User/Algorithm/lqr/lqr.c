#include "lqr.h"
#include "math.h"

/** LQR **/
// 初始化K矩阵
float wheel_K_L[6] = {0, 0, 0, 0, 0, 0};
float joint_K_L[6] = {0, 0, 0, 0, 0, 0};

float wheel_K_R[6] = {0, 0, 0, 0, 0, 0};
float joint_K_R[6] = {0, 0, 0, 0, 0, 0};

// K拟合系数矩阵
float wheel_fitting_factor[6][4] = {
        {-185.476182f,212.962472f,-98.000824f,0.308212f},
        {0.638458f,1.308719f,-5.421304f,0.169724f},

        {-21.227277f,21.893058f,-7.989148f,0.103646f},
        {-35.472854f,36.709733f,-13.696169f,0.083233f},

        {-2.780495f,11.679166f,-10.627296f,3.991314f},
        {-1.757234f,6.106843f,-5.285952f,1.940410f}
};float joint_fitting_factor[6][4] = {
        {245.862402f,-210.089580f,45.660964f,8.159524f},
        {19.292669f,-19.940580f,6.710597f,0.147419f},

        {-6.418857f,12.235853f,-8.368085f,2.469530f},
        {-12.480152f,22.366776f,-14.825803f,4.279036f},

        {138.880789f,-145.101045f,54.322918f,-2.038460f},
        {67.748609f,-70.649257f,26.360399f,-0.874570f}
};

/** 拟合K **/
void chassis_K_matrix_fitting(float L0, float K[6], const float KL[6][4]) {
    for (int i = 0; i < 6; i++) {
        K[i] = KL[i][0] * powf(L0, 3) + KL[i][1] * powf(L0, 2) + KL[i][2] * powf(L0, 1) + KL[i][3] * powf(L0, 0);
    }
}