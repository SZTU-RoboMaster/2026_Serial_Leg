#include "lqr.h"
#include "math.h"

/** LQR **/
// 初始化K矩阵
float wheel_K_L[6] = {0, 0, 0, 0, 0, 0};
float joint_K_L[6] = {0, 0, 0, 0, 0, 0};

float wheel_K_R[6] = {0, 0, 0, 0, 0, 0};
float joint_K_R[6] = {0, 0, 0, 0, 0, 0};

/** 腿长0.24m时的参数 **/
//float wheel_K[6] = {
//        -19.704005f,-2.460158f,-6.482999f,-5.189525f,14.358010f,2.389130f
//};float joint_K[6] = {
//        12.097046f,1.725750f,5.646495f,4.183662f,59.626285f,6.378566f
//};
/*********************/

// K拟合系数矩阵
float wheel_fitting_factor[6][4] = {
        {-163.981879f,194.082821f,-91.136777f,-1.003555f},
        {-1.728330f,3.627995f,-5.788250f,-0.035519f},

        {-18.453779f,20.316366f,-7.891984f,-0.161480f},
        {-23.437447f,26.039191f,-10.501432f,-0.295275f},

        {6.392413f,152.030235f,-154.640552f,48.765711f},
        {-9.284486f,21.590590f,-16.378390f,5.254056f}
};float joint_fitting_factor[6][4] = {
        {442.753060f,-349.167899f,57.261899f,15.267627f},
        {20.511649f,-15.124489f,0.639979f,2.129206f},

        {1.628519f,15.360910f,-16.173341f,5.085880f},
        {-7.353382f,29.533532f,-24.592317f,7.231943f},

        {2150.946834f,-2362.207024f,916.184583f,12.755780f},
        {162.470440f,-185.867295f,76.457365f,-1.097015f}
};
/** 拟合K **/
void chassis_K_matrix_fitting(float L0, float K[6], const float KL[6][4]) {
    for (int i = 0; i < 6; i++) {
        K[i] = KL[i][0] * powf(L0, 3) + KL[i][1] * powf(L0, 2) + KL[i][2] * powf(L0, 1) + KL[i][3] * powf(L0, 0);
    }
}