#include "lqr.h"
#include "math.h"

/** LQR **/
// 初始化K矩阵
float wheel_K_L[6] = {0, 0, 0, 0, 0, 0};
float joint_K_L[6] = {0, 0, 0, 0, 0, 0};

float wheel_K_R[6] = {0, 0, 0, 0, 0, 0};
float joint_K_R[6] = {0, 0, 0, 0, 0, 0};

/** 腿长0.24m时的参数 **/
//float wheel_K[6] = {
//        -19.704005f,-2.460158f,-6.482999f,-5.189525f,14.358010f,2.389130f
//};float joint_K[6] = {
//        12.097046f,1.725750f,5.646495f,4.183662f,59.626285f,6.378566f
//};
/*********************/

// K拟合系数矩阵
float wheel_fitting_factor[6][4] = {
        {-149.971303f,174.995525f,-87.523997f,-3.133503f},
        {-0.896325f,1.104629f,-5.897088f,-0.472626f},

        {-32.708437f,36.440029f,-14.761635f,-0.811185f},
        {-19.772185f,23.212155f,-10.726169f,-1.376193f},

        {-32.464609f,43.081374f,-23.559603f,6.804619f},
        {-12.593872f,16.356110f,-8.754039f,2.558837f}
};float joint_fitting_factor[6][4] = {
        {201.804409f,-170.408045f,33.406228f,10.956630f},
        {1.013856f,-0.228965f,-1.063527f,1.844798f},

        {-8.904144f,23.825517f,-19.484450f,6.709591f},
        {-25.423181f,37.922149f,-22.853907f,6.729686f},

        {165.112386f,-175.494934f,67.520492f,-0.885638f},
        {62.268698f,-66.181125f,25.511279f,-0.535861f}
};
/** 拟合K **/
void chassis_K_matrix_fitting(float L0, float K[6], const float KL[6][4]) {
    for (int i = 0; i < 6; i++) {
        K[i] = KL[i][0] * powf(L0, 3) + KL[i][1] * powf(L0, 2) + KL[i][2] * powf(L0, 1) + KL[i][3] * powf(L0, 0);
    }
}