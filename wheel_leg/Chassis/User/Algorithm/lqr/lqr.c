#include "lqr.h"
#include "math.h"

/** LQR **/
// 初始化K矩阵
float wheel_K_L[6] = {0, 0, 0, 0, 0, 0};
float joint_K_L[6] = {0, 0, 0, 0, 0, 0};

float wheel_K_R[6] = {0, 0, 0, 0, 0, 0};
float joint_K_R[6] = {0, 0, 0, 0, 0, 0};

/** 腿长0.24m时的参数 **/
//float wheel_K[6] = {
//        -19.704005f,-2.460158f,-6.482999f,-5.189525f,14.358010f,2.389130f
//};float joint_K[6] = {
//        12.097046f,1.725750f,5.646495f,4.183662f,59.626285f,6.378566f
//};
/*********************/

// K拟合系数矩阵
float wheel_fitting_factor[6][4] = {
        {-171.265773f,189.229767f,-81.511333f,-2.900255f},
        {-5.909859f,6.413675f,-4.934866f,-0.509827f},

        {-0.000279f,0.000292f,-0.000107f,-0.000017f},
        {-8.835675f,9.223530f,-3.397995f,-0.533199f},

        {-193.674570f,260.312217f,-137.380254f,32.802044f},
        {-29.544330f,37.254412f,-18.762926f,4.592400f}
};float joint_fitting_factor[6][4] = {
        {128.819529f,-98.200891f,12.329102f,8.297002f},
        {-9.246859f,12.156622f,-6.576692f,1.868100f},

        {-0.000338f,0.000465f,-0.000250f,0.000060f},
        {-10.684272f,14.694230f,-7.899068f,1.888140f},

        {630.838452f,-656.630751f,241.418595f,32.651955f},
        {68.750061f,-73.191157f,27.975047f,3.391916f}
};
/** 拟合K **/
void chassis_K_matrix_fitting(float L0, float K[6], const float KL[6][4]) {
    for (int i = 0; i < 6; i++) {
        K[i] = KL[i][0] * powf(L0, 3) + KL[i][1] * powf(L0, 2) + KL[i][2] * powf(L0, 1) + KL[i][3] * powf(L0, 0);
    }
}